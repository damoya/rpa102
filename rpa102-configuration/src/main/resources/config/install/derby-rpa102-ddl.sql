DROP TABLE FIRST_HOUR_DELAY_ENTRIES;
DROP TABLE BREAK_TIME_STAYS;
DROP TABLE CLASSROOM_INCIDENCES;
DROP TABLE STUDENTS_BY_ACADEMIC_YEAR;
DROP TABLE ACADEMIC_YEARS;
DROP TABLE COURSES;
DROP TABLE TEACHERS;
DROP TABLE STUDENTS;
DROP TABLE CONFIG;
DROP TABLE SMS;

--
DROP TABLE USER_ROLE;
DROP TABLE ROLE_PERMISSION;
DROP TABLE USERS;
DROP TABLE ROLES;
DROP TABLE PERMISSIONS;
--

CREATE TABLE CONFIG
(
	PARAM_ID VARCHAR (30) NOT NULL ,
	VALUE VARCHAR(60) NOT NULL ,
	PARAM_NAME VARCHAR(60),

	CONSTRAINT CONFIG_PK PRIMARY KEY (PARAM_ID)
);

--

CREATE TABLE ACADEMIC_YEARS
(
	ID VARCHAR(10) NOT NULL,
	DESCRIPTION VARCHAR(30) NOT NULL,

	CONSTRAINT ACADEMIC_YEARS_PK PRIMARY KEY (ID)
);


--

CREATE TABLE COURSES
(
	ID VARCHAR(8) NOT NULL,
	DESCRIPTION VARCHAR(60) NOT NULL,

	CONSTRAINT COURSES_PK PRIMARY KEY (ID)
);

--

CREATE TABLE TEACHERS
(
	ID VARCHAR(15) NOT NULL,
	NAME VARCHAR(40) NOT NULL,
	ACTIVE BOOLEAN,

	CONSTRAINT TEACHERS_PK PRIMARY KEY (ID)
);

--

CREATE TABLE STUDENTS
(
	ID VARCHAR(15) NOT NULL,
	NAME VARCHAR(40) NOT NULL,
	PHONE_1 VARCHAR(18),
	PHONE_2 VARCHAR(18),

	CONSTRAINT STUDENTS_PK PRIMARY KEY (ID)
);

CREATE TABLE SMS
(
	MSG_ID VARCHAR(50) NOT NULL,
	MSG_TEXT VARCHAR(480) NOT NULL,
	FROM_TEXT VARCHAR(30) NOT NULL,
	DEST_PHONE VARCHAR(18) NOT NULL,
	SENT_STATE VARCHAR(15) NOT NULL,
	REFERENCED_ELEMENT VARCHAR(60),

	CONSTRAINT SMS_PK PRIMARY KEY (MSG_ID)
);


--

CREATE TABLE STUDENTS_BY_ACADEMIC_YEAR
(
	STUDENT_ID VARCHAR(15) NOT NULL,
	ACADEMIC_YEAR_ID VARCHAR(10) NOT NULL,
	COURSE_ID  VARCHAR(8) NOT NULL,

	CONSTRAINT STUDENTS_BY_ACADEMIC_YEAR_PK PRIMARY KEY (STUDENT_ID, ACADEMIC_YEAR_ID),
	CONSTRAINT STUDENTS_BY_ACADEMIC_YEAR_FK1 FOREIGN KEY (ACADEMIC_YEAR_ID) REFERENCES ACADEMIC_YEARS (ID),
	CONSTRAINT STUDENTS_BY_ACADEMIC_YEAR_FK2 FOREIGN KEY (STUDENT_ID) REFERENCES STUDENTS (ID),
	CONSTRAINT STUDENTS_BY_ACADEMIC_YEAR_FK3 FOREIGN KEY (COURSE_ID) REFERENCES COURSES (ID)
);

--

CREATE TABLE BREAK_TIME_STAYS
(
	ID INTEGER NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1),
	ACADEMIC_YEAR_ID VARCHAR(10) NOT NULL,
	DATE DATE NOT NULL,
	TEACHER_ID VARCHAR(15) NOT NULL,
	STUDENT_ID VARCHAR(15) NOT NULL,
	FIRST_HOUR_DELAY_CAUSE BOOLEAN,
	SCHOOL_MGMT_ORDER_CAUSE BOOLEAN,

	CONSTRAINT BREAK_TIME_STAYS_PK PRIMARY KEY (ID),
	CONSTRAINT BREAK_TIME_STAYS_FK1 FOREIGN KEY (ACADEMIC_YEAR_ID) REFERENCES ACADEMIC_YEARS (ID),
	CONSTRAINT BREAK_TIME_STAYS_FK2 FOREIGN KEY (TEACHER_ID) REFERENCES TEACHERS (ID),
	CONSTRAINT BREAK_TIME_STAYS_FK3 FOREIGN KEY (STUDENT_ID) REFERENCES STUDENTS (ID)
);

--

CREATE TABLE FIRST_HOUR_DELAY_ENTRIES
(
	ID INTEGER NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1),
	ACADEMIC_YEAR_ID VARCHAR(10) NOT NULL,
	DATE DATE NOT NULL,
	TEACHER_ID VARCHAR(15) NOT NULL,
	STUDENT_ID VARCHAR(15) NOT NULL,
	ARRIVAL_TIME TIME NOT NULL,

	CONSTRAINT FIRST_HOUR_DELAY_ENTRIES_PK PRIMARY KEY (ID),
	CONSTRAINT FIRST_HOUR_DELAY_ENTRIES_FK1 FOREIGN KEY (ACADEMIC_YEAR_ID) REFERENCES ACADEMIC_YEARS (ID),
	CONSTRAINT FIRST_HOUR_DELAY_ENTRIES_FK2 FOREIGN KEY (TEACHER_ID) REFERENCES TEACHERS (ID),
	CONSTRAINT FIRST_HOUR_DELAY_ENTRIES_FK3 FOREIGN KEY (STUDENT_ID) REFERENCES STUDENTS (ID)
);

--

CREATE TABLE CLASSROOM_INCIDENCES
(
	ID INTEGER NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1),
	ACADEMIC_YEAR_ID VARCHAR(10) NOT NULL,
	DATE DATE NOT NULL,
	TEACHER_ID VARCHAR(15) NOT NULL,
	STUDENT_ID VARCHAR(15) NOT NULL,
	ARRIVAL_TIME TIME NOT NULL,
	SENDER_TEACHER_ID VARCHAR(15),
	SCHOOL_MGMT_ORDER_CAUSE BOOLEAN,
	USE_OF_MOBILE_CAUSE BOOLEAN,
	BREAK_MATERIAL_CAUSE BOOLEAN,
	LACK_OF_RESPECT_CAUSE BOOLEAN,
	GO_OUT_FROM_SCHOOL_CAUSE BOOLEAN,
	DISTURB_CAUSE BOOLEAN,
	BREACH_OF_ORDER_CAUSE BOOLEAN,
	TO_NOT_WORK_CAUSE BOOLEAN,
	SMOKE_CAUSE BOOLEAN,
	STRONG_BAD_BEHAVIOUR BOOLEAN,
	INTERRUPT_STUDENTS_STUDY BOOLEAN,
	OTHER_CAUSE BOOLEAN,

	CONSTRAINT CLASSROOM_INCIDENCES_PK PRIMARY KEY (ID),
	CONSTRAINT CLASSROOM_INCIDENCES_FK1 FOREIGN KEY (ACADEMIC_YEAR_ID) REFERENCES ACADEMIC_YEARS (ID),
	CONSTRAINT CLASSROOM_INCIDENCES_FK2 FOREIGN KEY (TEACHER_ID) REFERENCES TEACHERS (ID),
	CONSTRAINT CLASSROOM_INCIDENCES_FK3 FOREIGN KEY (STUDENT_ID) REFERENCES STUDENTS (ID),
	CONSTRAINT CLASSROOM_INCIDENCES_FK4 FOREIGN KEY (SENDER_TEACHER_ID) REFERENCES TEACHERS (ID)
);
--
-- 	<sequences>
--		<sequence ID="FIRST_HOUR_DELAY_ENTRIES.ID"/>
--		<sequence ID="STUDENTS.ID"/>
--		<sequence ID="TEACHERS.ID"/>
--		<sequence ID="GROUPS.ID"/>
--		<sequence ID="CLASSROOM_INCIDENCES.ID"/>
--		<sequence ID="BREAK_TIME_STAYS.ID"/>
--	</sequences>
--

INSERT INTO ACADEMIC_YEARS (ID, DESCRIPTION) VALUES ('2015-2016', 'Año Académico 2015-2016');
INSERT INTO ACADEMIC_YEARS (ID, DESCRIPTION) VALUES ('2016-2017', 'Año Académico 2016-2017');
INSERT INTO ACADEMIC_YEARS (ID, DESCRIPTION) VALUES ('2017-2018', 'Año Académico 2017-2018');
INSERT INTO ACADEMIC_YEARS (ID, DESCRIPTION) VALUES ('2018-2019', 'Año Académico 2018-2019');

INSERT INTO CONFIG (PARAM_ID, VALUE, PARAM_NAME) VALUES ('CurrentAcademicYear', '2018-2019', 'Año Académico por defecto');

--
-- Security model
--

CREATE TABLE ROLES
(
	ROLE_ID VARCHAR (20) NOT NULL,
	DESCRIPTION VARCHAR(60) NOT NULL ,

	CONSTRAINT ROLES_PK PRIMARY KEY (ROLE_ID)
);

CREATE TABLE PERMISSIONS
(
	PERMISSION_ID VARCHAR (40) NOT NULL,
	DESCRIPTION VARCHAR(60) NOT NULL ,

	CONSTRAINT PERMISSIONS_PK PRIMARY KEY (PERMISSION_ID)
);


CREATE TABLE ROLE_PERMISSION
(
	ROLE_ID VARCHAR (20) NOT NULL,
	PERMISSION_ID VARCHAR (40) NOT NULL,

	CONSTRAINT ROLE_PERMISSION_PK PRIMARY KEY (ROLE_ID, PERMISSION_ID),
	CONSTRAINT ROLE_PERMISSION_FK1 FOREIGN KEY (ROLE_ID) REFERENCES ROLES (ROLE_ID),
	CONSTRAINT ROLE_PERMISSION_FK2 FOREIGN KEY (PERMISSION_ID) REFERENCES PERMISSIONS (PERMISSION_ID)
);

CREATE TABLE USERS
(
	USER_ID VARCHAR (20) NOT NULL,
	NAME VARCHAR(60) NOT NULL,
	PASSWORD VARCHAR(60),
	TEACHER_ID VARCHAR(15),

	CONSTRAINT USERS_PK PRIMARY KEY (USER_ID),
	CONSTRAINT USERS_FK1 FOREIGN KEY (TEACHER_ID) REFERENCES TEACHERS (ID)
);

CREATE TABLE USER_ROLE
(
	USER_ID VARCHAR (20) NOT NULL,
	ROLE_ID VARCHAR (20) NOT NULL,

	CONSTRAINT USER_ROLE_PK PRIMARY KEY (USER_ID, ROLE_ID),
	CONSTRAINT USER_ROLE_FK1 FOREIGN KEY (USER_ID) REFERENCES USERS (USER_ID),
	CONSTRAINT USER_ROLE_FK2 FOREIGN KEY (ROLE_ID) REFERENCES ROLES (ROLE_ID)
);

INSERT INTO USERS (USER_ID, NAME, PASSWORD) VALUES ('admin', 'Administrador', '21232f297a57a5a743894a0e4a801fc3');
INSERT INTO USERS (USER_ID, NAME, PASSWORD) VALUES ('rpa', 'rpa', '21232f297a57a5a743894a0e4a801fc3');
INSERT INTO USERS (USER_ID, NAME, PASSWORD) VALUES ('teacher', 'Profesor', '8d788385431273d11e8b43bb78f3aa41');
INSERT INTO USERS (USER_ID, NAME, PASSWORD) VALUES ('Jefatura', 'Jefatura', '598900b7b36ca67065548567bef52e66');
INSERT INTO USERS (USER_ID, NAME, PASSWORD) VALUES ('dmoya', 'dmoya', '21232f297a57a5a743894a0e4a801fc3');
INSERT INTO USERS (USER_ID, NAME, PASSWORD) VALUES ('evamag', 'evamag', '21232f297a57a5a743894a0e4a801fc3');
INSERT INTO USERS (USER_ID, NAME, PASSWORD) VALUES ('mariags', 'María Gonzalez Santos', '263bce650e68ab4e23f28263760b9fa5');

INSERT INTO ROLES (ROLE_ID, DESCRIPTION) VALUES ('Rpa102Management', 'Equipo Directivo');
INSERT INTO ROLES (ROLE_ID, DESCRIPTION) VALUES ('Rpa102Admin', 'Administrador');
INSERT INTO ROLES (ROLE_ID, DESCRIPTION) VALUES ('Rpa102Teacher', 'Profesor asignado al aula 102');
INSERT INTO ROLES (ROLE_ID, DESCRIPTION) VALUES ('Rpa102Orientation', 'Personal de Orientación');


INSERT INTO PERMISSIONS (PERMISSION_ID, DESCRIPTION) VALUES ('FirstHourDelay.NewEntry', 'Nuevo Retraso a 1ª Hora');
INSERT INTO PERMISSIONS (PERMISSION_ID, DESCRIPTION) VALUES ('FirstHourDelay.queryWks', 'Acceso Consulta Retrasos a 1ª Hora');
INSERT INTO PERMISSIONS (PERMISSION_ID, DESCRIPTION) VALUES ('ClassroomIncidence.NewEntry', 'Nuevo Parte de Aula');
INSERT INTO PERMISSIONS (PERMISSION_ID, DESCRIPTION) VALUES ('ClassroomIncidence.queryWks', 'Acceso Consulta Partes de Aula');
INSERT INTO PERMISSIONS (PERMISSION_ID, DESCRIPTION) VALUES ('BreakTimeStays.NewEntry', 'Nuevo Estancia en Recreo');
INSERT INTO PERMISSIONS (PERMISSION_ID, DESCRIPTION) VALUES ('BreakTimeStays.queryWks', 'Acceso Consulta Estancias en Recreo');
INSERT INTO PERMISSIONS (PERMISSION_ID, DESCRIPTION) VALUES ('Admin', 'Administración');
INSERT INTO PERMISSIONS (PERMISSION_ID, DESCRIPTION) VALUES ('SMS.send', 'Envios de SMS');
INSERT INTO PERMISSIONS (PERMISSION_ID, DESCRIPTION) VALUES ('SMS.sendToManySrudents', 'Envios de SMS a varios estudiantes simultaneamente');
INSERT INTO PERMISSIONS (PERMISSION_ID, DESCRIPTION) VALUES ('DataManagement', 'Mantenimiento de Datos');

INSERT INTO ROLE_PERMISSION (ROLE_ID, PERMISSION_ID) VALUES ('Rpa102Admin', 'Admin');

INSERT INTO ROLE_PERMISSION (ROLE_ID, PERMISSION_ID) VALUES ('Rpa102Teacher', 'FirstHourDelay.NewEntry');
INSERT INTO ROLE_PERMISSION (ROLE_ID, PERMISSION_ID) VALUES ('Rpa102Teacher', 'ClassroomIncidence.NewEntry');
INSERT INTO ROLE_PERMISSION (ROLE_ID, PERMISSION_ID) VALUES ('Rpa102Teacher', 'BreakTimeStays.NewEntry');
INSERT INTO ROLE_PERMISSION (ROLE_ID, PERMISSION_ID) VALUES ('Rpa102Teacher', 'SMS.send');

INSERT INTO ROLE_PERMISSION (ROLE_ID, PERMISSION_ID) VALUES ('Rpa102Management', 'FirstHourDelay.NewEntry');
INSERT INTO ROLE_PERMISSION (ROLE_ID, PERMISSION_ID) VALUES ('Rpa102Management', 'FirstHourDelay.queryWks');
INSERT INTO ROLE_PERMISSION (ROLE_ID, PERMISSION_ID) VALUES ('Rpa102Management', 'ClassroomIncidence.NewEntry');
INSERT INTO ROLE_PERMISSION (ROLE_ID, PERMISSION_ID) VALUES ('Rpa102Management', 'ClassroomIncidence.queryWks');
INSERT INTO ROLE_PERMISSION (ROLE_ID, PERMISSION_ID) VALUES ('Rpa102Management', 'BreakTimeStays.NewEntry');
INSERT INTO ROLE_PERMISSION (ROLE_ID, PERMISSION_ID) VALUES ('Rpa102Management', 'BreakTimeStays.queryWks');
INSERT INTO ROLE_PERMISSION (ROLE_ID, PERMISSION_ID) VALUES ('Rpa102Management', 'SMS.send');
INSERT INTO ROLE_PERMISSION (ROLE_ID, PERMISSION_ID) VALUES ('Rpa102Management', 'SMS.sendToManySrudents');
INSERT INTO ROLE_PERMISSION (ROLE_ID, PERMISSION_ID) VALUES ('Rpa102Management', 'DataManagement');

INSERT INTO ROLE_PERMISSION (ROLE_ID, PERMISSION_ID) VALUES ('Rpa102Orientation', 'SMS.sendToManySrudents');

INSERT INTO USER_ROLE (USER_ID, ROLE_ID) VALUES ('admin', 'Rpa102Admin');
INSERT INTO USER_ROLE (USER_ID, ROLE_ID) VALUES ('teacher', 'Rpa102Teacher');
INSERT INTO USER_ROLE (USER_ID, ROLE_ID) VALUES ('rpa', 'Rpa102Management');
INSERT INTO USER_ROLE (USER_ID, ROLE_ID) VALUES ('rpa', 'Rpa102Admin');
INSERT INTO USER_ROLE (USER_ID, ROLE_ID) VALUES ('rpa', 'Rpa102Orientation');
INSERT INTO USER_ROLE (USER_ID, ROLE_ID) VALUES ('Jefatura', 'Rpa102Management');
INSERT INTO USER_ROLE (USER_ID, ROLE_ID) VALUES ('dmoya', 'Rpa102Management');
INSERT INTO USER_ROLE (USER_ID, ROLE_ID) VALUES ('dmoya', 'Rpa102Admin');
INSERT INTO USER_ROLE (USER_ID, ROLE_ID) VALUES ('dmoya', 'Rpa102Orientation');
INSERT INTO USER_ROLE (USER_ID, ROLE_ID) VALUES ('evamag', 'Rpa102Management');
INSERT INTO USER_ROLE (USER_ID, ROLE_ID) VALUES ('evamag', 'Rpa102Admin');
INSERT INTO USER_ROLE (USER_ID, ROLE_ID) VALUES ('evamag', 'Rpa102Orientation');
INSERT INTO USER_ROLE (USER_ID, ROLE_ID) VALUES ('mariags', 'Rpa102Orientation');



